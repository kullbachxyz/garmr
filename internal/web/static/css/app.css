/* --- Design tokens ------------------------------------------------------- */
:root{
  /* Light (default) */
  --fg:#111;
  --bg:#fafafa;
  --muted:#777;

  --card:#fff;
  --border:#eee;
  --surface:#f5f5f5;

  --btn-bg:#fff;
  --btn-border:#e4e4e4;
  --btn-hover:#ededed;

  --link:#111;
  --accent:#3f3f46;
  --accent-hover:#323236;
  
  --success-bg:#dcfce7;
  --success-border:#bbf7d0;
  --success-fg:#166534;
  --error-bg:#fee2e2;
  --error-border:#fecaca;
  --error-fg:#991b1b;
  --shadow:0 1px 2px rgba(0,0,0,.04);

  /* Heart Rate Zone Colors (Garmin Connect style) */
  --hr-zone-1: #94a3b8;  /* Zone 1 (Recovery) - Light gray */
  --hr-zone-2: #3b82f6;  /* Zone 2 (Base) - Blue */
  --hr-zone-3: #10b981;  /* Zone 3 (Aerobic) - Green */
  --hr-zone-4: #f59e0b;  /* Zone 4 (Threshold) - Orange */
  --hr-zone-5: #dc2626;  /* Zone 5 (VO2 Max) - Red */
}

:root[data-theme="dark"]{
  --fg:#e5e7eb;
  --bg:#121317;
  --muted:#9ca3af;

  --card:#1c1d21;
  --border:#2a2b30;
  --surface:#16171b;

  --btn-bg:#1f2024;
  --btn-border:#2a2b30;
  --btn-hover:#24262b;

  --link:#cbd5e1;
  --accent:#3f3f46;
  --accent-hover:#323236;

  --success-bg:#0f2518;
  --success-border:#1f3a2b;
  --success-fg:#34d399;
  --error-bg:#2e1b23;
  --error-border:#52323c;
  --error-fg:#fca5a5;
  --shadow:0 2px 10px rgba(0,0,0,.4);

  --hr-zone-1: #9ca3af;
  --hr-zone-2: #3b82f6;
  --hr-zone-3: #10b981;
  --hr-zone-4: #fbbf24;
  --hr-zone-5: #f87171;
}

@media (prefers-color-scheme: dark){
  :root:not([data-theme="light"]){
    --fg:#e5e7eb;
    --bg:#121317;
    --muted:#9ca3af;

    --card:#1c1d21;
    --border:#2a2b30;
    --surface:#16171b;

    --btn-bg:#1f2024;
    --btn-border:#2a2b30;
    --btn-hover:#24262b;

    --link:#cbd5e1;
    --accent:#3f3f46;

    --success-bg:#0f2518;
    --success-border:#1f3a2b;
    --success-fg:#34d399;
    --error-bg:#2e1b23;
    --error-border:#52323c;
    --error-fg:#fca5a5;
    --shadow:0 2px 10px rgba(0,0,0,.4);
  }
}

/* --- Base ---------------------------------------------------------------- */
*{ box-sizing:border-box; }
html, body{ height:100%; }
body{
  margin:0;
  font:15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
  color:var(--fg);
  background:var(--bg);
}
a{ color:var(--link); }
.activities a{ color:var(--fg); }

/* Layout */
.container{ max-width:1100px; margin:32px auto; padding:0 16px; }

/* --- Topbar -------------------------------------------------------------- */
/* make the header a flex row so we can push controls to the right */
.topbar{
  position:sticky; top:0;
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:10px 16px;
  display:flex; align-items:center; gap:8px;
  z-index:1000;
  box-shadow:var(--shadow);
}
.topbar a{ text-decoration:none; color:var(--fg); font-weight:400; margin: 0 5px; }
#logo { font-weight:800; font-size: 20px; }
.nav{ width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.nav-links{ display:flex; align-items:center; gap:12px; }
.nav-auth{ margin-left:auto; display:flex; align-items:center; gap:12px; }
.user-menu{ position:relative; }
.user-menu summary{
  list-style:none;
  cursor:pointer;
  font-weight:600;
  color:var(--muted);
}
.user-menu summary::-webkit-details-marker{ display:none; }
.user-menu-panel{
  position:absolute;
  right:0;
  top:calc(100% + 4px);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  box-shadow:var(--shadow);
  padding:6px 0;
  min-width:150px;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.user-menu[open] .user-menu-panel{ visibility:visible; opacity:1; }
.user-menu-panel a{
  padding:6px 12px;
  color:var(--fg);
  text-decoration:none;
}
.user-menu-panel a:hover{
  background:var(--surface);
}
.logout-form{ margin:0; }
.login-link{ font-weight:600; }

.btn{
  border:1px solid var(--btn-border);
  border-radius:6px;
  background:var(--btn-bg);
  color:var(--fg);
  font-size:14px;
  font-weight:600;
  padding:6px 12px;
  cursor:pointer;
  transition:background .15s ease,color .15s ease,border-color .15s ease;
  text-decoration:none;
}
.btn:hover{ background:var(--btn-hover); }
.btn:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* keep leaflet under the topbar */
#leafmap, .leaflet-container, .leaflet-pane { z-index:0; }

/* small, muted status text */
#importStatus{ color:var(--muted); }

/* --- Auth card ----------------------------------------------------------- */
.auth-card{
  max-width:420px;
  margin:48px auto;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:24px;
  box-shadow:var(--shadow);
}
.auth-card h1{ margin-top:0; }
.auth-card form{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.form-field{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.form-field label{ font-weight:600; font-size:14px; color:var(--fg); }
.form-field input{
  border:1px solid var(--border);
  border-radius:6px;
  padding:10px 12px;
  font-size:15px;
  background:var(--card);
  color:var(--fg);
}
.form-field select{
  border:1px solid var(--border);
  border-radius:6px;
  padding:10px 12px;
  font-size:15px;
  background:var(--card);
  color:var(--fg);
}
input[type="file"]{
  border:1px dashed var(--border);
  border-radius:6px;
  padding:8px;
  background:var(--card);
  color:var(--fg);
}
input[type="file"]::-webkit-file-upload-button,
input[type="file"]::file-selector-button{
  border:1px solid var(--btn-border);
  border-radius:6px;
  background:var(--btn-bg);
  color:var(--fg);
  padding:6px 10px;
  margin-right:8px;
  cursor:pointer;
  font-weight:600;
}
input[type="file"]::-webkit-file-upload-button:hover,
input[type="file"]::file-selector-button:hover{
  background:var(--btn-hover);
}
.btn-primary{
  font-size:15px;
  padding:8px 14px;
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
.btn-primary:hover{ background:var(--accent-hover); border-color:var(--accent-hover); color:#fff; }
.alert{
  border-radius:6px;
  padding:10px 12px;
  margin-bottom:10px;
  font-weight:500;
}
.alert.error{
  background:var(--error-bg);
  border:1px solid var(--error-border);
  color:var(--error-fg);
}
.alert.success{
  background:var(--success-bg);
  border:1px solid var(--success-border);
  color:var(--success-fg);
}

/* --- Tables & key/value -------------------------------------------------- */
.tbl{ width:100%; border-collapse:collapse; }
.tbl th,.tbl td{
  text-align:left; padding:8px 6px; border-bottom:1px solid var(--border); color:var(--fg);
}
.kv{ list-style:none; padding:0; margin:0; }
.kv li{
  display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dotted var(--border);
}
.kv span{ color:var(--muted); }

.activity-actions{
  text-align:right;
  white-space:nowrap;
}
.activity-actions form{
  margin:0;
  display:inline;
}
.btn-danger{
  font-size:13px;
  padding:6px 12px;
}
.btn-danger:focus{
  outline:2px solid rgba(55,65,81,0.35);
  outline-offset:1px;
}

.stats-filter{
  margin:0;
  display:flex;
  align-items:center;
  gap:10px;
  color:var(--muted);
}
.stats-filter select{
  border:1px solid var(--btn-border);
  border-radius:6px;
  padding:6px 12px;
  font-size:14px;
  font-weight:600;
  background:var(--btn-bg);
  color:var(--fg);
  cursor:pointer;
}
.tabs{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:0;
}
.tabs-spacer{
  flex:1;
}
.tab{
  border-radius:6px;
}
.tab.active{
  background:var(--btn-hover);
}
.tabs-spacer{ flex:1; }
.tab-controls{
  display:flex;
  gap:6px;
  align-items:center;
  font-size:14px;
  color:var(--fg);
}
.tab-controls select{
  margin-left:6px;
  border:1px solid var(--btn-border);
  border-radius:6px;
  padding:6px 12px;
  font-size:14px;
  font-weight:600;
  background:var(--btn-bg);
  color:var(--fg);
  cursor:pointer;
}
#controls-year{ display:none; }

.stats-controls{
  display:flex;
  align-items:center;
  gap:18px;
  flex-wrap:wrap;
  margin-bottom:12px;
  width:100%;
}
.stats-controls.simple{
  gap:16px;
}
.mode-toggle{
  display:flex;
  align-items:center;
  gap:4px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:20px;
  padding:4px;
}
.map-toggle{
  margin-left:auto;
}
.mode-option{
  border:none;
  background:transparent;
  color:var(--muted);
  padding:6px 12px;
  border-radius:14px;
  font-weight:700;
  cursor:pointer;
  text-decoration:none;
}
.mode-option.active{
  background:var(--btn-hover);
  color:var(--fg);
}
.stats-tabs-inline{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:14px;
  justify-content:flex-start;
  flex:1;
}
.stats-filter-inline{
  display:flex;
  align-items:center;
  gap:10px;
}
.chart-wrap{
  position:relative;
  height:320px;
  width:100%;
  margin-bottom:26px;
}
#chart-year{ display:none; }

.pagination{
  margin-top:12px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  align-items:center;
}
.pagination a,
.pagination span{
  padding:4px 10px;
  border:1px solid var(--border);
  border-radius:6px;
  text-decoration:none;
  color:var(--fg);
  font-size:14px;
}
.pagination a:hover{
  background:var(--surface);
}
.pagination .current{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
.pagination span.disabled{
  color:var(--muted);
  border-color:var(--border);
  background:transparent;
}

/* --- Grid ---------------------------------------------------------------- */
.grid{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
@media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

/* --- Cards --------------------------------------------------------------- */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px 12px;
  box-shadow:var(--shadow);
}
.card-head{ font-weight:600; color:var(--fg); }
  .chart-canvas { display:block; width:100%; height:100%; }

.latest-activity-card{ margin:16px 0; display:flex; flex-direction:column; gap:8px; }
.latest-top{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.latest-ago{ color:var(--muted); font-weight:600; font-size:14px; }
.latest-meta{ display:flex; align-items:center; gap:10px; color:var(--muted); }
.latest-title{ font-size:18px; font-weight:700; color:var(--fg); text-decoration:none; }
.latest-title:hover{ text-decoration:underline; }
.latest-date{ color:var(--muted); font-size:14px; }

/* --- Metrics ------------------------------------------------------------- */
.metrics{
  display:grid; grid-template-columns: repeat(5, minmax(0,1fr));
  gap:12px; margin:6px 0 4px;
}
.metric{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px 12px;
}
.week-summary-metrics .metric{
  background:var(--surface);
}
.metric-value{ font-size:22px; font-weight:700; }
.metric-value .metric-unit{ font-size:14px; font-weight:600; color:var(--muted); margin-left:3px; }
.metric-label{ font-size:12px; color:var(--muted); margin-top:2px; }
.latest-metrics{ grid-template-columns: repeat(3, minmax(0,1fr)); }

/* --- Stats grid ---------------------------------------------------------- */
.stats-grid{
  display:grid; grid-template-columns: repeat(4, minmax(0, 1fr));
  gap:10px;
}
.stats-grid > div{
  border:1px solid var(--border); border-radius:8px; padding:8px 10px; background:var(--card);
  display:flex; align-items:center; justify-content:space-between;
}
.stats-grid > div span{ color:var(--muted); }

/* --- Calendar ----------------------------------------------------------- */
.calendar-card{ padding:12px; }
.calendar-weekdays{
  display:grid;
  grid-template-columns:repeat(7, minmax(90px, 1fr));
  gap:6px;
  color:var(--muted);
  font-weight:600;
  padding:4px 4px 8px;
  text-align:center;
}
.calendar-weekdays-month{
  grid-template-columns:repeat(7, minmax(90px, 1fr)) 180px;
}
.calendar-week-summary-head{
  text-align:left;
  padding-left:10px;
}
.calendar-grid{
  display:grid;
  grid-template-columns:repeat(7, minmax(90px, 1fr));
  gap:6px;
}
.calendar-grid-month{
  grid-template-columns:repeat(7, minmax(90px, 1fr)) 180px;
}
.calendar-day{
  border:1px solid var(--border);
  border-radius:10px;
  padding:6px;
  background:var(--card);
  display:flex;
  flex-direction:column;
  gap:6px;
  min-height:85px;
}
.calendar-day.is-muted{ opacity:0.55; }
.calendar-day.is-today{
  border-color: var(--accent);
  box-shadow: var(--shadow);
}
.calendar-day-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-weight:700;
}
.calendar-date{ font-size:16px; }
.calendar-weekday{ color:var(--muted); font-size:12px; }
.calendar-entries{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:4px;
}
.calendar-entry{
  display:flex;
  flex-direction:column;
  text-decoration:none;
  color:var(--fg);
  padding:6px;
  border-radius:8px;
  background:var(--surface);
  border:1px solid var(--border);
}
.calendar-entry:hover{ background:var(--btn-hover); }
.calendar-entry-title{ font-weight:600; }
.calendar-entry-meta{ color:var(--muted); font-size:13px; }
.calendar-entry-empty{ color:var(--muted); font-size:13px; }
.calendar-week-summary{
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 10px;
  background:var(--surface);
  display:flex;
  flex-direction:column;
  gap:6px;
}
.calendar-week-summary-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:13px;
}
.calendar-week-summary-row span{ color:var(--muted); }
.calendar-card a{ text-decoration:none; }
.sport-running{ border-left:3px solid #10b981; }
.sport-cycling{ border-left:3px solid #3b82f6; }
.sport-walking{ border-left:3px solid #94a3b8; }
.sport-hiking{ border-left:3px solid #fbbf24; }
.sport-swimming{ border-left:3px solid #06b6d4; }
.sport-generic{ border-left:3px solid #ec4899; }
.week-card{ padding:12px; }
.week-days{ display:grid; grid-template-columns: repeat(7, minmax(140px, 1fr)); gap:8px; }
.week-day{
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px;
  background:var(--card);
  display:flex;
  flex-direction:column;
  gap:6px;
}
.week-day.is-today{
  border-color: var(--accent);
  box-shadow: var(--shadow);
}
.week-date{ font-weight:700; }
.week-day-meta{ color:var(--muted); font-size:12px; display:flex; gap:4px; flex-wrap:wrap; }
.week-day-entries{ display:flex; flex-direction:column; gap:6px; }

/* --- Responsive tweaks --------------------------------------------------- */
@media (max-width: 900px){
  .metrics{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  .stats-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}
@media (max-width: 600px){
  .latest-meta{ flex-direction:column; align-items:flex-start; gap:4px; }
  .latest-metrics{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}

/* --- Leaflet theming to match cards ------------------------------------- */
.leaflet-container .leaflet-control{
  background:var(--card);
  border:1px solid var(--border);
  color:var(--fg);
}
.leaflet-container .leaflet-bar a, 
.leaflet-container .leaflet-bar a:hover{
  background:var(--card);
  border-bottom:1px solid var(--border);
  color:var(--fg);
}
.leaflet-popup-content-wrapper, .leaflet-popup-tip{
  background:var(--card);
  color:var(--fg);
  border:1px solid var(--border);
}
.leaflet-control-attribution{ background:var(--card); color:var(--muted); border:1px solid var(--border); }
